"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[991],{7991:function(t,e,s){s.r(e),s.d(e,{default:function(){return f}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"main-body-content center-container",staticStyle:{"margin-left":"400px","margin-top":"50px"}},[e("div",{staticStyle:{display:"flex","align-items":"flex-start"}},[e("div",{staticStyle:{width:"240px",border:"1px solid #000b17","border-radius":"5px",height:"calc(50vh + 125px)"}},[e("div",{staticClass:"header"},[t._v("è®ºå›ç”¨æˆ·")]),e("div",{staticClass:"user-list-box",staticStyle:{height:"calc(50vh + 125px - 42px)","overflow-y":"scroll","background-color":"#f0f0f0"}},t._l(t.users.USER,(function(s){return e("div",{staticClass:"user-list-item",on:{click:function(e){return t.selectToUser(s)}}},[e("img",{class:{online:"åœ¨çº¿"===s.info,offline:"ç¦»çº¿"===s.info},attrs:{src:s.avatar}}),e("span",{staticStyle:{flex:"1","margin-left":"10px","font-size":"16px"},style:{color:s.id.toString()===t.toUser.toString()?"#3a8ee6":""}},[t._v(" "+t._s(s.name)+" "),"åœ¨çº¿"===s.info?e("span",{staticStyle:{color:"#4CAF50"}},[t._v("åœ¨çº¿")]):e("span",{staticStyle:{color:"gray"}},[t._v("ç¦»çº¿")])]),t.unRead?.[s.id]?e("div",{staticClass:"user-list-item-badge"},[t._v(t._s(t.unRead?.[s.id]))]):t._e()])})),0)]),e("div",{staticStyle:{width:"50%",border:"1px solid #ddd","border-radius":"5px","background-color":"#f1f1f1",margin:"0 10px"}},[e("div",{staticStyle:{padding:"20px 0","text-align":"center","border-bottom":"1px solid #ddd",color:"#000","background-color":"#eee",height:"60px"}},[t._v(" "+t._s(t.toUserName)+" ")]),e("div",{staticClass:"im-message-box"},t._l(t.groupedMessages,(function(s,i){return e("div",{key:i},t._l(s,(function(o,r){return e("div",{key:r},[0===r?e("div",{staticStyle:{"text-align":"center","font-weight":"bold","margin-bottom":"5px"}},[t._v(t._s(i))]):t._e(),t.shouldDisplayTime(r,s)?e("div",[e("div",{staticStyle:{"text-align":"center"},domProps:{innerHTML:t._s(o.time)}})]):t._e(),o.fromuser===t.fromUser.toString()?e("div",{staticStyle:{display:"flex","flex-direction":"row-reverse","align-items":"flex-start"}},[e("img",{staticStyle:{width:"40px",height:"40px","border-radius":"50%","margin-left":"10px"},attrs:{src:o.fromavatar,alt:""}}),"text"===o.type?e("div",{staticClass:"im-message im-message-right",domProps:{innerHTML:t._s(o.content)}}):t._e(),"img"===o.type?e("div",{staticClass:"im-message",staticStyle:{padding:"0"}},[e("el-image",{staticStyle:{width:"100px"},attrs:{src:o.content,alt:"","preview-src-list":[o.content]},on:{load:t.scrollToBottom}})],1):t._e(),"file"===o.type?e("div",{staticClass:"im-message im-message-download",on:{click:function(e){return t.download(o.content)}}},[e("div",[e("i",{staticClass:"el-icon-folder-opened"}),e("span",[t._v(t._s(o.content.substring(o.content.indexOf("-")+1)))])])]):t._e()]):e("div",{staticStyle:{display:"flex","align-items":"flex-start"}},[e("img",{staticStyle:{width:"40px",height:"40px","border-radius":"50%","margin-right":"10px"},attrs:{src:o.fromavatar,alt:""}}),e("div",{staticStyle:{width:"100%"}},[e("div",{staticStyle:{color:"#888","font-size":"12px",width:"50%"}},[t._v(" "+t._s(t.toUserName)+" ")]),"text"===o.type?e("div",{staticClass:"im-message im-message-left",domProps:{innerHTML:t._s(o.content)}}):t._e(),"img"===o.type?e("div",{staticClass:"im-message",staticStyle:{padding:"0"}},[e("el-image",{staticStyle:{width:"100px"},attrs:{src:o.content,alt:"","preview-src-list":[o.content]},on:{load:t.scrollToBottom}})],1):t._e(),"file"===o.type?e("div",{staticClass:"im-message im-message-download",on:{click:function(e){return t.download(o.content)}}},[e("div",[e("i",{staticClass:"el-icon-folder-opened"}),e("span",[t._v(t._s(o.content.substring(o.content.indexOf("-")+1)))])])]):t._e()])])])})),0)})),0),e("div",{staticStyle:{padding:"10px 5px","border-top":"1px solid #ddd",display:"flex","align-items":"center",width:"100%"}},[e("el-popover",{attrs:{placement:"top",width:"300",trigger:"click"}},[e("div",{staticClass:"emoji-box"},t._l(t.emojis,(function(s,i){return e("span",{key:i,staticStyle:{"margin-right":"5px","font-size":"20px",cursor:"pointer"},domProps:{innerHTML:t._s(s)},on:{click:function(e){return t.clickEmoji(s)}}})})),0),e("i",{staticClass:"fa fa-smile-o",staticStyle:{"font-size":"22px",color:"#666"},attrs:{slot:"reference"},slot:"reference"})]),e("div",{staticStyle:{"margin-left":"5px"}},[e("el-upload",{attrs:{action:"http://47.109.28.131:9090/files/upload","show-file-list":!1,"on-success":t.handleFile}},[e("i",{staticClass:"fa fa-folder-open-o",staticStyle:{"font-size":"20px",color:"#666"}})])],1),e("div",{staticStyle:{flex:"1","background-color":"#fff",margin:"0 5px","max-height":"50px","overflow-y":"auto",padding:"10px",border:"1px solid #ddd","border-radius":"2px",outline:"none","font-size":"18px"},attrs:{id:"im-content",contenteditable:""},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send.apply(null,arguments)}}}),e("el-button",{staticStyle:{border:"none"},attrs:{type:"primary"},on:{click:t.send}},[t._v("å‘é€")])],1)])])])])},o=[],r=(s(7658),s(4471));const n="ğŸ˜€,ğŸ˜,ğŸ˜‚,ğŸ˜ƒ,ğŸ˜„,ğŸ˜…,ğŸ˜†,ğŸ˜‰,ğŸ˜Š,ğŸ˜‹,ğŸ˜,ğŸ˜,ğŸ˜˜,ğŸ˜—,ğŸ˜™,ğŸ˜š,ğŸ˜‡,ğŸ˜,ğŸ˜‘,ğŸ˜¶,ğŸ˜,ğŸ˜£,ğŸ˜¥,ğŸ˜®,ğŸ˜¯,ğŸ˜ª,ğŸ˜«,ğŸ˜´,ğŸ˜Œ,ğŸ˜›,ğŸ˜œ,ğŸ˜,ğŸ˜’,ğŸ˜“,ğŸ˜”,ğŸ˜•,ğŸ˜²,ğŸ˜·,ğŸ˜–,ğŸ˜,ğŸ˜Ÿ,ğŸ˜¤,ğŸ˜¢,ğŸ˜­,ğŸ˜¦,ğŸ˜§,ğŸ˜¨,ğŸ˜¬,ğŸ˜°,ğŸ˜±,ğŸ˜³,ğŸ˜µ,ğŸ˜¡,ğŸ˜ ,ğŸ’˜,â¤,ğŸ’“,ğŸ’”,ğŸ’•,ğŸ’–,ğŸ’—,ğŸ’™,ğŸ’š,ğŸ’›,ğŸ’œ,ğŸ’,ğŸ’,ğŸ’Ÿ,â£,ğŸ’ª,ğŸ‘ˆ,ğŸ‘‰,â˜,ğŸ‘†,ğŸ‘‡,âœŒ,âœ‹,ğŸ‘Œ,ğŸ‘,ğŸ‘,âœŠ,ğŸ‘Š,ğŸ‘‹,ğŸ‘,ğŸ‘,âœ,ğŸ‡,ğŸˆ,ğŸ‰,ğŸŠ,ğŸ‹,ğŸŒ,ğŸ,ğŸ,ğŸ,ğŸ,ğŸ‘,ğŸ’,ğŸ“,ğŸ…,ğŸ†,ğŸŒ½,ğŸ„,ğŸŒ°,ğŸ,ğŸ–,ğŸ—,ğŸ”,ğŸŸ,ğŸ•,ğŸ³,ğŸ²,ğŸ±,ğŸ˜,ğŸ™,ğŸš,ğŸ›,ğŸœ,ğŸ,ğŸ ,ğŸ¢,ğŸ£,ğŸ¤,ğŸ¥,ğŸ¡,ğŸ¦,ğŸ§,ğŸ¨,ğŸ©,ğŸª,ğŸ‚,ğŸ°,ğŸ«,ğŸ¬,ğŸ­,ğŸ®,ğŸ¯,ğŸ¼,â˜•,ğŸµ,ğŸ¶,ğŸ·,ğŸ¸,ğŸ¹,ğŸº,ğŸ»,ğŸ´,ğŸŒ¹,ğŸ€,ğŸ,ğŸ’°,ğŸ“±,ğŸŒ™,ğŸ,ğŸ‚,ğŸƒ,ğŸŒ·,ğŸ’,ğŸ”ª,ğŸ”«,ğŸ€,âš½,âš¡,ğŸ‘„,ğŸ‘,ğŸ”¥,ğŸ™ˆ,ğŸ™‰,ğŸ™Š,ğŸµ,ğŸ’,ğŸ¶,ğŸ•,ğŸ©,ğŸº,ğŸ±,ğŸ˜º,ğŸ˜¸,ğŸ˜¹,ğŸ˜»,ğŸ˜¼,ğŸ˜½,ğŸ™€,ğŸ˜¿,ğŸ˜¾,ğŸˆ,ğŸ¯,ğŸ…,ğŸ†,ğŸ´,ğŸ,ğŸ®,ğŸ‚,ğŸƒ,ğŸ„,ğŸ·,ğŸ–,ğŸ—,ğŸ½,ğŸ,ğŸ‘,ğŸ,ğŸª,ğŸ«,ğŸ˜,ğŸ­,ğŸ,ğŸ€,ğŸ¹,ğŸ°,ğŸ‡,ğŸ»,ğŸ¨,ğŸ¼,ğŸ¾,ğŸ”,ğŸ“,ğŸ£,ğŸ¤,ğŸ¥,ğŸ¦,ğŸ§,ğŸ¸,ğŸŠ,ğŸ¢,ğŸ,ğŸ²,ğŸ‰,ğŸ³,ğŸ‹,ğŸ¬,ğŸŸ,ğŸ ,ğŸ¡,ğŸ™,ğŸš,ğŸŒ,ğŸ›,ğŸœ,ğŸ,ğŸ,ğŸ¦‹,ğŸ˜ˆ,ğŸ‘¿,ğŸ‘¹,ğŸ‘º,ğŸ’€,â˜ ,ğŸ‘»,ğŸ‘½,ğŸ‘¾,ğŸ’£";var a=n;let l;var d={data(){return{user:{},permission:[],emojis:[],messages:[],users:{},fromUser:"",toUser:"",toAvatar:"",unRead:{},toUserName:"",timeIntervalThreshold:18e4}},computed:{groupedMessages(){const t={};return this.messages.forEach((e=>{const s=e.time.split(" ")[0];t[s]||(t[s]=[]),t[s].push(e)})),t}},mounted(){this.emojis=a.split(","),this.user=JSON.parse(localStorage.getItem("xm-user")||"{}"),this.fromUser=this.user.id,this.fromUser=this.fromUser+"";let t=this.user?.id.toString();l=new WebSocket(`ws://47.109.28.131:9090/imserverSingle/${t}`),l.onopen=()=>{console.log("websocket open")},l.onclose=()=>{console.log("websocket close")},l.onmessage=t=>{if(t.data){let e=JSON.parse(t.data);if(e.users&&e.users.length)return void this.loadOnline();e.touser===this.fromUser.toString()&&this.loadOnline(),(e.content&&e.fromuser===this.fromUser.toString()&&e.touser===this.toUser.toString()||e.touser===this.fromUser.toString()&&e.fromuser===this.toUser.toString())&&(this.messages.push(e),this.scrollToBottom(),this.loadOnline()),this.toUser.toString()===e.fromuser?(this.setUnReadNums(),this.loadOnline()):(this.loadUnReadNums(),this.loadOnline())}},this.load(),this.loadOnline(),r.Z.get("/user/selectAllOnline?userId="+this.user.id.toString()).then((t=>{t.data=t.data.filter((t=>t.id!==this.user.id)),this.$set(this.users,"USER",t.data)}))},beforeDestroy(){l&&l.close()},methods:{shouldDisplayTime(t,e){if(0===t)return!0;const s=new Date(e[t].time).getTime(),i=new Date(e[t-1].time).getTime();return s-i>this.timeIntervalThreshold},load(){r.Z.get("/imsingle?fromUser="+this.fromUser.toString()+"&toUser="+this.toUser.toString()).then((t=>{"200"===t.code?(this.messages=t.data,this.scrollToBottom()):this.$notify.error(t.msg),this.loadUnReadNums()}))},setUnReadNums(){r.Z.get("/imsingle?fromUser="+this.fromUser.toString()+"&toUser="+this.toUser.toString()).then((t=>{this.loadUnReadNums()}))},loadUnReadNums(){r.Z.get("/imsingle/unReadNums?toUsername="+this.fromUser.toString()).then((t=>{this.unRead=t.data}))},loadOnline(){r.Z.get("/user/selectAllOnline?userId="+this.user.id.toString()).then((t=>{t.data=t.data.filter((t=>t.id!==this.user.id)),this.$set(this.users,"USER",t.data)}))},send(){let t=document.getElementById("im-content");const e=t.textContent.trim();if(0!==e.length)if(e.length>150)this.$notify.error("å­—æ•°è¶…è¿‡150ï¼Œè¯·é‡æ–°è¾“å…¥!");else if(this.toUser){if(l){let t=this.getMessage("text");l.send(JSON.stringify(t))}document.getElementById("im-content").innerHTML=""}else this.$notify.error("è¯·é€‰æ‹©èŠå¤©ç”¨æˆ·");else this.$notify.error("è¯·è¾“å…¥èŠå¤©å†…å®¹!")},selectToUser(t){console.log(this.user.id),"10"!==this.user.id.toString()?(this.toUserName=t.name,this.toUser=t.id,this.toAvatar=t.avatar,this.load()):this.$notify.error("è®¿å®¢æ— æƒæŸ¥çœ‹ï¼Œè¯·æ³¨å†Œè´¦å·å“¦")},download(t){window.open(t)},getMessage(t){let e=document.getElementById("im-content");const s=e.innerHTML;if(s||"text"!==t)return{fromuser:this.fromUser,fromavatar:this.user.avatar,touser:this.toUser,toavatar:this.toAvatar,content:s,type:t};this.$notify.error("è¯·è¾“å…¥èŠå¤©å†…å®¹")},handleFile(t){if(l){let e=this.getMessage("img");e.content=t.data;let s=t.data.substring(t.data.lastIndexOf(".")+1);["png","jpg","jpeg","gif","bmp","tiff","svg","webp","jfif"].includes(s)?e.type="img":e.type="file",l.send(JSON.stringify(e))}},clickEmoji(t){document.getElementById("im-content").innerHTML+=t},scrollToBottom(){this.$nextTick((()=>{let t=document.getElementsByClassName("im-message-box")[0];t.scrollTop=t.scrollHeight,console.log("è§¦å‘æ»šåŠ¨")}))}}},c=d,m=s(3736),g=(0,m.Z)(c,i,o,!1,null,"780ef200",null),f=g.exports}}]);
//# sourceMappingURL=991.82f63b47.js.map